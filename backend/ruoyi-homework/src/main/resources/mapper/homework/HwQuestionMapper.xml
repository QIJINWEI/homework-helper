<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ruoyi.homework.mapper.HwQuestionMapper">
    <resultMap id="HwQuestionResult" type="com.ruoyi.homework.domain.HwQuestion">
        <id property="id" column="id"/>
        <result property="userId" column="user_id"/>
        <result property="questionType" column="question_type"/>
        <result property="subject" column="subject"/>
        <result property="difficulty" column="difficulty"/>
        <result property="content" column="content"/>
        <result property="correctAnswer" column="correct_answer"/>
        <result property="imageUrl" column="image_url"/>
        <result property="ocrRawText" column="ocr_raw_text"/>
        <result property="status" column="status"/>
    </resultMap>
    <select id="selectQuestionList" resultMap="HwQuestionResult">
        SELECT * FROM hw_question
        <where>
            <if test="subject != null and subject != ''">AND subject = #{subject}</if>
            <if test="questionType != null and questionType != ''">AND question_type = #{questionType}</if>
            <if test="difficulty != null and difficulty != ''">AND difficulty = #{difficulty}</if>
            AND status = 1
        </where>
        ORDER BY create_time DESC
    </select>
    <select id="selectQuestionById" resultMap="HwQuestionResult">
        SELECT * FROM hw_question WHERE id = #{id} AND status = 1
    </select>
    <insert id="insertQuestion" parameterType="com.ruoyi.homework.domain.HwQuestion" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO hw_question (user_id, question_type, subject, difficulty, content, options, correct_answer, image_url, ocr_raw_text, status, create_time)
        VALUES (#{userId}, #{questionType}, #{subject}, #{difficulty}, #{content}, #{options,jdbcType=OTHER}, #{correctAnswer}, #{imageUrl}, #{ocrRawText}, 1, NOW())
    </insert>
    <update id="updateQuestion" parameterType="com.ruoyi.homework.domain.HwQuestion">
        UPDATE hw_question SET subject=#{subject}, difficulty=#{difficulty}, content=#{content}, options=#{options,jdbcType=OTHER}, correct_answer=#{correctAnswer}, image_url=#{imageUrl}, ocr_raw_text=#{ocrRawText}, update_time=NOW() WHERE id=#{id}
    </update>
    <delete id="deleteQuestionById">UPDATE hw_question SET status=0, update_time=NOW() WHERE id=#{id}</delete>
    <resultMap id="HwExplanationResult" type="com.ruoyi.homework.domain.HwExplanation">
        <id property="id" column="id"/>
        <result property="questionId" column="question_id"/>
        <result property="analysis" column="analysis"/>
        <result property="tips" column="tips"/>
        <result property="similarQuestions" column="similar_questions"/>
        <result property="aiModel" column="ai_model"/>
    </resultMap>
    <select id="selectExplanationByQuestionId" resultMap="HwExplanationResult">
        SELECT * FROM hw_explanation WHERE question_id = #{questionId}
    </select>
    <insert id="insertExplanation" parameterType="com.ruoyi.homework.domain.HwExplanation" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO hw_explanation (question_id, analysis, steps, key_points, tips, similar_questions, ai_model, create_time)
        VALUES (#{questionId}, #{analysis}, #{steps,jdbcType=OTHER}, #{keyPoints,jdbcType=OTHER}, #{tips}, #{similarQuestions}, #{aiModel}, NOW())
    </insert>
</mapper>